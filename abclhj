--getgenv().AutoFarm = true
--getgenv().WebhookURL = "" --If not used do not write anything
if game.PlaceId == 79546208627805 then
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local TeleportEvent = ReplicatedStorage:FindFirstChild("RemoteEvents") and ReplicatedStorage.RemoteEvents:FindFirstChild("TeleportEvent")

    if TeleportEvent then
        local function TeleportAdd(num)
            local args = {
                [1] = "Add",
                [2] = num
            }
            TeleportEvent:FireServer(unpack(args))
            task.wait(0.5)
            TeleportEvent:FireServer("Chosen", nil, 1)
        end

        -- spam liên tục trong thread riêng
        task.spawn(function()
            while true do
                TeleportAdd(3)
                TeleportAdd(2)
                TeleportAdd(1)
                task.wait(0.3)
            end
        end)
    else
        warn("Không tìm thấy TeleportEvent, bỏ qua spam.")
    end
end


--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("StarterGui")
local TeleportService = game:GetService("TeleportService")
local Workspace = game:GetService("Workspace")
local Remote = game:GetService("ReplicatedStorage").RemoteEvents.RequestTakeDiamonds
local Interface = LocalPlayer:WaitForChild("PlayerGui"):WaitForChild("Interface")
local DiamondCount = Interface:WaitForChild("DiamondCount"):WaitForChild("Count")
local HttpService = game:GetService("HttpService")

local function detectLang()
    local locale = LocalPlayer.LocaleId:lower() -- ví dụ: vi-vn, en-us
    if string.find(locale, "vi") then
        return "vi"
    else
        return "en"
    end
end

local LangPack = {
    ["vi"] = {
        GuiTitle = "Farm diamond test | Credit: Cáo Mod",
        Diamonds = "Diamond: ",
        UpdateNote = [[
--------------------------------------------
CẬP NHẬT:
»Auto stronghold (beta)(có thể tắt nó ở getgenv)
»
--------------------------------------------
lưu ý auto stronghold chỉ mới update nên rất nhiều lỗi
--------------------------------------------
Thông tin:
»Youtube: Cáo Mod
»Nếu có bug hãy report trên Discord
»Cảm ơn vì đã test script farm
»Chúc bạn farm vui vẻ!
]],
        CopyBtn = "Sao chép link Discord",
        NotifyWaiting = "Đang chờ HumanoidRootPart...",
        NotifyBegin = "Bắt đầu farm!"
    },
    ["en"] = {
        GuiTitle = "debug V67 | Credit: Cáo Mod",
        Diamonds = "Diamonds: ",
        UpdateNote = [[
--------------------------------------------
UPDATE:
»Auto stronghold (beta)(can be disabled via getgenv)
»kill aura without holding tool
»
--------------------------------------------
note:auto stronghold is just beta with lots of bugs, don't enable it
--------------------------------------------
Info:
»Youtube: Cáo Mod
»If there is any bug please report it on discord
»Thanks for testing this farm script
»Enjoy farming diamonds!
]],
        CopyBtn = "Copy Discord Link",
        NotifyWaiting = "Waiting for HumanoidRootPart...",
        NotifyBegin = "Begin farming!"
    }
}

local Lang = LangPack[detectLang()]

--// Functions
local PlaceID = game.PlaceId
local AllIDs = {}
local maxTeleports = 5

local function loadServerList()
    local ok, data = pcall(function()
        return HttpService:JSONDecode(readfile("NotSameServers.json"))
    end)
    if ok and data then
        for _, id in ipairs(data) do
            AllIDs[tostring(id)] = true
        end
    else
        writefile("NotSameServers.json", HttpService:JSONEncode({}))
    end
end

local function saveServerList()
    local list = {}
    for id in pairs(AllIDs) do
        table.insert(list, id)
    end
    writefile("NotSameServers.json", HttpService:JSONEncode(list))
end

local function isNewServer(ID)
    return not AllIDs[ID]
end

local function teleport(ID)
    AllIDs[ID] = true
    saveServerList()
    pcall(function()
        TeleportService:TeleportToPlaceInstance(PlaceID, ID, LocalPlayer)
    end)
end

local function getServers(cursor)
    local url = 'https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100'
    if cursor then url = url .. "&cursor=" .. cursor end
    local ok, res = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(url))
    end)
    return ok and res or nil
end

local function serverHop()
    loadServerList()
    local teleportCount = 0
    local cursor = nil

    while teleportCount < maxTeleports do
        local site = getServers(cursor)
        if not site then break end

        cursor = site.nextPageCursor ~= "null" and site.nextPageCursor or nil

        for _, server in ipairs(site.data) do
            local id = tostring(server.id)
            if tonumber(server.playing) < tonumber(server.maxPlayers) and isNewServer(id) then
                teleport(id)
                teleportCount += 1
                wait(0.1)
                break
            end
        end

        if not cursor then break end
    end
end

local function rainbowStroke(x)
    task.spawn(function()
        while task.wait() do
            for i = 0, 1, 0.01 do
                x.Color = Color3.fromHSV(i, 1, 1)
                task.wait(0.02)
            end
        end
    end)
end

local function notify(ti, te, du)
    pcall(function()
        CoreGui:SetCore("SendNotification", {
            Title = ti or "Info",
            Text = te or "",
            Duration = du or 3
        })
    end)
end

        

local function sendWebhook(looted, total, chestType)
    local HttpService = game:GetService("HttpService")
    local WebhookURL = getgenv().WebhookURL
    if not WebhookURL then return end

    local embed = {
        ["title"] = "Farm Announcement",
        ["color"] = 65280,
        ["fields"] = {
            {["name"] = "Diamonds Collected ", ["value"] = tostring(looted), ["inline"] = true},
            {["name"] = "Total Diamonds", ["value"] = tostring(total), ["inline"] = true},
            {["name"] = "Source", ["value"] = chestType, ["inline"] = true}
        },
        ["footer"] = {["text"] = "Cáo Mod Farm Diamond Script | Subscribe to Cáo Mod"}
    }

    local headers = { ["Content-Type"] = "application/json" }
    local body = HttpService:JSONEncode({ embeds = { embed } })

    pcall(function()
        request({
            Url = WebhookURL,
            Method = "POST",
            Headers = headers,
            Body = body
        })
    end)
end

task.spawn(function()
    while task.wait(1) do
        local displayName = LocalPlayer.DisplayName
        local targetName = displayName .. " Body"
        local chars = Workspace:FindFirstChild("Characters")
        if chars and chars:FindFirstChild(targetName) then
            serverHop()
            return
        end
    end
end)

--\\ Ui
local a = Instance.new("ScreenGui", game.CoreGui)
a.Name = "Farm diamond Skibidi"

local b = Instance.new("Frame", a)
b.Size = UDim2.new(0, 250, 0, 340)
b.Position = UDim2.new(0, 80, 0, 20)
b.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
b.BorderSizePixel = 0
b.Active = true
b.Draggable = true

local c = Instance.new("UICorner", b)
c.CornerRadius = UDim.new(0, 8)

local d = Instance.new("UIStroke", b)
d.Thickness = 1.5
rainbowStroke(d)

local e = Instance.new("TextLabel", b)
e.Size = UDim2.new(1, 0, 0, 30)
e.BackgroundTransparency = 1
e.Text = Lang.GuiTitle
e.TextColor3 = Color3.fromRGB(255, 255, 255)
e.Font = Enum.Font.GothamBold
e.TextSize = 14
e.TextStrokeTransparency = 0.6

local f = Instance.new("TextLabel", b)
f.Size = UDim2.new(1, -20, 0, 35)
f.Position = UDim2.new(0, 10, 0, 40)
f.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
f.TextColor3 = Color3.new(1, 1, 1)
f.Font = Enum.Font.GothamBold
f.TextSize = 14
f.BorderSizePixel = 0

local g = Instance.new("UICorner", f)
g.CornerRadius = UDim.new(0, 6)

task.spawn(function()
    while task.wait(0.2) do
        f.Text = Lang.Diamonds .. DiamondCount.Text
    end
end)

local h = Instance.new("Frame", b)
h.Position = UDim2.new(0, 10, 0, 80)
h.Size = UDim2.new(1, -20, 0, 250)
h.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
h.BorderSizePixel = 0

local i = Instance.new("UICorner", h)
i.CornerRadius = UDim.new(0, 6)

local j = Instance.new("TextLabel", h)
j.Size = UDim2.new(1, -10, 1, -45)
j.Position = UDim2.new(0, 5, 0, 5)
j.BackgroundTransparency = 1
j.Text = Lang.UpdateNote
j.TextColor3 = Color3.fromRGB(255, 255, 255)
j.Font = Enum.Font.Gotham
j.TextSize = 13
j.TextWrapped = true
j.TextYAlignment = Enum.TextYAlignment.Top

local k = Instance.new("TextButton", h)
k.Size = UDim2.new(0, 150, 0, 30)
k.Position = UDim2.new(0.5, -75, 1, -35)
k.Text = Lang.CopyBtn
k.TextColor3 = Color3.new(1,1,1)
k.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
k.Font = Enum.Font.GothamBold
k.TextSize = 12
k.AutoButtonColor = true

local l = Instance.new("UICorner", k)
l.CornerRadius = UDim.new(0, 6)

k.MouseButton1Click:Connect(function()
    setclipboard("https://discord.gg/mSrMzVuc3h")
    notify("Copied!", "Discord link copied to clipboard", 4)
end)

notify("Notification", Lang.NotifyWaiting, 3)
repeat 
    task.wait(0.5)
until LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
notify("Notification", Lang.NotifyBegin, 3)

local initialDiamond = tonumber(DiamondCount.Text) or 0

local ChestList = {}
for _, v in pairs(workspace.Items:GetChildren()) do
    if string.find(v.Name, "Chest") and v.Name ~= "Stronghold Diamond Chest" then
        for _, d in pairs(v:GetDescendants()) do
            if d:IsA("ProximityPrompt") then
                table.insert(ChestList, d)
            end
        end
    end
end

for _, v in pairs(ChestList) do
    if v and v:IsA("ProximityPrompt") and v.Enabled == true then
        pcall(function()
            fireproximityprompt(v)
        end)
        task.wait(0.1)
    end
end

task.wait(0.5)

local lootStart = tick()
local lootTimeout = 7
local diamondsExist = true

while diamondsExist do
    diamondsExist = false
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name == "Diamond" then
            diamondsExist = true
            if hrp then
                hrp.CFrame = v:GetPivot() + Vector3.new(0,5,0)
                hrp.Anchored = true
                Remote:FireServer(v)
                task.wait(0.2)
                hrp.Anchored = false
            end
        end
    end

    
    if (tick() - lootStart) > lootTimeout then
        break
    end

    task.wait(0.2)
end

wait(1)

if getgenv().AutoFarm == nil then
    getgenv().AutoFarm = false
end

local stronghold = workspace.Items:FindFirstChild("Stronghold Diamond Chest")
if stronghold and hrp then
    hrp.CFrame = stronghold:GetPivot()
    hrp.Anchored = true

    local proxPrompt
    repeat
        task.wait(0.1)
        local prox = stronghold:FindFirstChild("Main")
        if prox and prox:FindFirstChild("ProximityAttachment") then
            proxPrompt = prox.ProximityAttachment:FindFirstChild("ProximityInteraction")
        end
    until proxPrompt

    local opened = false
    local startTime = tick()
    while tick() - startTime < 10 do
        if not proxPrompt or not proxPrompt.Parent then
            opened = true
            break
        end
        pcall(function()
            fireproximityprompt(proxPrompt)
        end)
        task.wait(0.2)
    end

    if not opened then
        if getgenv().AutoFarm == false then
            local finalDiamond = tonumber(DiamondCount.Text) or initialDiamond
            local lootedAmount = finalDiamond - initialDiamond
            sendWebhook(lootedAmount, finalDiamond, "Stronghold (failed)")
            serverHop()
            return
        else
            notify("Notification", "Starting Raid stronghold...", 5)
            hrp.Anchored = false
            local Players = game:GetService("Players")
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local VirtualInputManager = game:GetService("VirtualInputManager")
            local player = Players.LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            local initialDiamond = tonumber(DiamondCount.Text) or 0

            local KillAura = false
local SelectedTool
local aurasAtivas = {}

local ToolPriority = {
    "Morningstar",
    "Katana",
    "Spear",
    "Strong Axe",
    "Good Axe",
    "Old Axe"
}

local function EquipTool(tool)
    if tool and tool:IsDescendantOf(player.Inventory) then
        local args = {
            [1] = "FireAllClients",
            [2] = tool
        }
        game:GetService("ReplicatedStorage").RemoteEvents.EquipItemHandle:FireServer(unpack(args))
        return true
    end
    return false
end

local function SelectTool()
    for _, toolName in ipairs(ToolPriority) do
        for _, tool in ipairs(player.Inventory:GetChildren()) do
            if tool.Name == toolName then
                if EquipTool(tool) then
                    return tool
                end
            end
        end
    end
    return nil
end

local function ToggleKillAura(state)
    KillAura = state

    if not state then
        for npc, _ in pairs(aurasAtivas) do
            aurasAtivas[npc] = nil
        end
        return
    end

    if not SelectedTool or not SelectedTool:IsDescendantOf(player.Backpack) and not SelectedTool:IsDescendantOf(player.Character) then
        SelectedTool = SelectTool()
        if not SelectedTool then
            notify("Error", "No suitable weapon found!", 5)
            return
        end
    end

    task.spawn(function()
        while KillAura do
            for _, npc in ipairs(workspace.Characters:GetChildren()) do
                local humanoid = npc:FindFirstChildOfClass("Humanoid")
                if humanoid and humanoid.Health > 0 and 
                   (npc.Name == "Cultist" or npc.Name == "Crossbow Cultist" or npc.Name == "Juggernaut Cultist") 
                   and not aurasAtivas[npc] then

                    aurasAtivas[npc] = true

                    task.spawn(function()
                        local ToolID = "27_" .. SelectedTool:GetAttribute("Owner")
                        local root = npc.PrimaryPart or npc:FindFirstChild("HumanoidRootPart")

                        while aurasAtivas[npc] and root and humanoid.Health > 0 do
                            pcall(function()
                                game:GetService("ReplicatedStorage").RemoteEvents.ToolDamageObject:InvokeServer(
                                    npc, SelectedTool, ToolID, root.CFrame
                                )
                            end)
                            task.wait(0.00001) -- spam max tốc
                        end
                        aurasAtivas[npc] = nil
                    end)
                end
            end
            task.wait()
        end
    end)
end

            local wallsFolder = workspace.Map.Landmarks.Stronghold.Building.Interior.Walls
            local targetSize = Vector3.new(11, 9.19999885559082, 2)
            local targetPart
            for _, part in ipairs(wallsFolder:GetChildren()) do
                if part.Size == targetSize then
                    targetPart = part
                    break
                end
            end

            if not targetPart then
                serverHop()
                return
            end

            local forwardOffset, verticalOffset, rightOffset = 4, -12, 0
            local localOffset = CFrame.new(rightOffset, verticalOffset, forwardOffset)
            local KeepTP = true
            task.spawn(function()
                while KeepTP do
                    if hrp and hrp.Parent then
                        hrp.CFrame = targetPart.CFrame * localOffset
                    end
                    task.wait()
                end
            end)

            
        local found = false
local startTime = tick()

repeat
    task.wait(1)
    if tick() - startTime > 120 then
        serverHop()
        return
    end

    for _, npc in ipairs(workspace.Characters:GetChildren()) do
        if npc:IsA("Model") and npc.Name:lower():find("cultist") then
            local root = npc.PrimaryPart or npc:FindFirstChild("HumanoidRootPart")
            if root and hrp then
                local dist = (root.Position - hrp.Position).Magnitude
                if dist <= 100 then
                    found = true
                    break
                end
            end
        end
    end
until found

KeepTP = false
            
            ToggleKillAura(true)

            local stronghold = workspace.Items:FindFirstChild("Stronghold Diamond Chest")
            if stronghold then
                local chestCFrame
                if stronghold:IsA("Model") then
                    chestCFrame = stronghold:GetPivot()
                elseif stronghold:IsA("BasePart") then
                    chestCFrame = stronghold.CFrame
                end
                if chestCFrame then
        task.spawn(function()
            while stronghold.Parent and not workspace:FindFirstChild("Diamond", true) do
                task.wait(0.1)
                pcall(function()
                    hrp.CFrame = chestCFrame + Vector3.new(0, 5, 0) -- đứng cao hơn chest 5 studs cho an toàn
                end)
            end
        end)
    end

                local proxPrompt
repeat      
    task.wait(0.1)      
    local prox = stronghold:FindFirstChild("Main")      
    if prox and prox:FindFirstChild("ProximityAttachment") then      
        proxPrompt = prox.ProximityAttachment:FindFirstChild("ProximityInteraction")      
    end      
until proxPrompt      

repeat
    pcall(function()
        fireproximityprompt(proxPrompt)
    end)
    task.wait(0.2)
until not proxPrompt or not proxPrompt.Parent
repeat
    task.wait(0.2)
until workspace:FindFirstChild("Diamond", true)
            end
            task.wait(3)
            
            for _, diamond in ipairs(workspace:GetDescendants()) do
                if diamond:IsA("Model") and diamond.Name == "Diamond" then
                    pcall(function()
                        ReplicatedStorage.RemoteEvents.RequestTakeDiamonds:FireServer(diamond)
                    end)
                end
            end

            local finalDiamond = tonumber(DiamondCount.Text) or initialDiamond
            local lootedAmount = finalDiamond - initialDiamond
            sendWebhook(lootedAmount, finalDiamond, "Auto Raid Stronghold")
            
            wait(3)
            serverHop()
            return
        end
    end

    -- Chest đã mở -> chờ Diamond spawn
    local spawnTimeout = tick()
    while not workspace:FindFirstChild("Diamond", true) and tick() - spawnTimeout < 10 do
        task.wait(0.2)
    end

    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name == "Diamond" then
            pcall(function()
                Remote:FireServer(v)
            end)
        end
    end

    local finalDiamond = tonumber(DiamondCount.Text) or initialDiamond
    local lootedAmount = finalDiamond - initialDiamond
    sendWebhook(lootedAmount, finalDiamond, "Stronghold")

    task.wait(3)
    serverHop()
    return
else
    wait(1)
    local finalDiamond = tonumber(DiamondCount.Text) or initialDiamond
    local lootedAmount = finalDiamond - initialDiamond
    sendWebhook(lootedAmount, finalDiamond, "Chest")
    serverHop()
    return
end
